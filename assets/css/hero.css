:root{
  --fx-tilt: 10;
  --fx-rgb-shift: 10px;
  --fx-glow: 1.05;
}

/* Make the theme's header band a positioned container we can mount into */
.page-cover,
.page-header,
.banner,
.post-cover {
  position: relative;
  overflow: hidden;
  min-height: 45vh; /* ensure visible band height */
}

/* Keep header text above the injected effect */
.page-cover > *:not(.fx-hero),
.page-header > *:not(.fx-hero),
.banner > *:not(.fx-hero),
.post-cover > *:not(.fx-hero){
  position: relative;
  z-index: 1;
}

/* Our injected FX background fills the header band */
.fx-hero.fx-hero--mounted {
  position: absolute;
  inset: 0;
  z-index: 0;
  isolation: isolate;
  --mx: .5;
  --my: .5;
  pointer-events: none; /* header remains interactive */
  background: #111; /* base color behind image */
}

.fx-hero__layer{
  position: absolute; inset: 0;
  background-size: cover; background-position: 50% 50%;
  transform: scale(1.04);
  will-change: transform, filter;
  filter: contrast(1.05) saturate(1.05) brightness(var(--fx-glow));
}
.fx-hero__base{ z-index: 0; }
.fx-hero__r, .fx-hero__g, .fx-hero__b{ z-index: 0; mix-blend-mode: screen; opacity: .65; }

/* Channel tints for pseudo RGB split */
.fx-hero__r{ filter: brightness(1.1) sepia(1) saturate(6) hue-rotate(-20deg); }
.fx-hero__g{ filter: brightness(1.1) sepia(1) saturate(6) hue-rotate(90deg); }
.fx-hero__b{ filter: brightness(1.1) sepia(1) saturate(6) hue-rotate(200deg); }

/* Parallax tilt on hover/move */
.page-cover:hover .fx-hero__layer,
.page-header:hover .fx-hero__layer,
.banner:hover .fx-hero__layer,
.post-cover:hover .fx-hero__layer{
  transform:
    translate3d(calc((var(--mx) - .5) * -12px), calc((var(--my) - .5) * -12px), 0)
    scale(1.06)
    rotateX(calc((.5 - var(--my)) * var(--fx-tilt) * 1deg))
    rotateY(calc((var(--mx) - .5) * var(--fx-tilt) * 1deg));
}

.fx-hero .fx-hero__r{ transform: translateX(var(--rgb-x, 0px)) translateY(var(--rgb-y, 0px)) scale(1.06); }
.fx-hero .fx-hero__g{ transform: translateX(calc(var(--rgb-x, 0px) * -1)) translateY(calc(var(--rgb-y, 0px) * .6)) scale(1.06); }
.fx-hero .fx-hero__b{ transform: translateX(calc(var(--rgb-x, 0px) * .8)) translateY(calc(var(--rgb-y, 0px) * -0.5)) scale(1.06); }

/* Glitch pulse */
.fx-hero.is-glitching .fx-hero__r,
.fx-hero.is-glitching .fx-hero__g,
.fx-hero.is-glitching .fx-hero__b{
  animation: fx-glitch 180ms steps(2) 1;
}
@keyframes fx-glitch{
  0%{ opacity: .85; }
  50%{ opacity: .2; }
  100%{ opacity: .65; }
}

/* Grain overlay */
.fx-hero__grain{
  position: absolute; inset: 0; z-index: 0; pointer-events: none;
  mix-blend-mode: overlay;
}

/* Hide the TOC / category sidebar only on the homepage */
.home #toc,
.home .toc,
.home .post-toc,
.home .toc-wrap,
.home .toc-container,
.home .toc-aside,
.home .home-sidebar,
.home .home-categories { display: none !important; }

@media (prefers-reduced-motion: reduce){
  .fx-hero__layer,
  .page-cover:hover .fx-hero__layer,
  .page-header:hover .fx-hero__layer,
  .banner:hover .fx-hero__layer,
  .post-cover:hover .fx-hero__layer { transform: none !important; }
  .fx-hero.is-glitching .fx-hero__r,
  .fx-hero.is-glitching .fx-hero__g,
  .fx-hero.is-glitching .fx-hero__b{ animation: none !important; }
  .fx-hero__grain{ display: none; }
}
